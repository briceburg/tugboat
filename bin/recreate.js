// Generated by CoffeeScript 1.8.0
var cull, seq, up;

seq = require('../src/seq');

cull = require('./cull');

up = require('./up');

module.exports = function(tugboat, groupname, servicenames, callback) {
  if (groupname != null) {
    return cull(tugboat, groupname, servicenames, function() {
      return up(tugboat, groupname, servicenames, function() {
        if (callback != null) {
          return callback();
        }
      });
    });
  }
  return tugboat.init(function(errors) {
    if (errors != null) {
      return init_errors(errors);
    }
    return tugboat.diff(function(err, groups) {
      var g, groupstoprocess, _fn, _i, _len;
      if (err != null) {
        console.error();
        console.error('  docker is down'.red);
        console.error();
        process.exit(1);
      }
      groupstoprocess = Object.keys(groups).filter(function(g) {
        g = groups[g];
        return Object.keys(g.services).filter(function(s) {
          s = g.services[s];
          if (s.service == null) {
            return false;
          }
          return s.containers.filter(function(c) {
            return c.inspect.State.Running;
          }).length !== 0;
        }).length !== 0;
      });
      _fn = function(g) {
        return seq(function(cb) {
          cull(tugboat, g, [], function() {
            return up(tugboat, g, []);
          });
          return cb();
        });
      };
      for (_i = 0, _len = groupstoprocess.length; _i < _len; _i++) {
        g = groupstoprocess[_i];
        _fn(g);
      }
      return seq(function(cb) {
        cb();
        if (callback != null) {
          return callback();
        }
      });
    });
  });
};
