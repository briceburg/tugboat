// Generated by CoffeeScript 1.8.0
var series;

require('colors');

series = function(tasks, callback) {
  var next, result;
  tasks = tasks.slice(0);
  next = function(cb) {
    var task;
    if (tasks.length === 0) {
      return cb();
    }
    task = tasks.shift();
    return task(function() {
      return next(cb);
    });
  };
  result = function(cb) {
    return next(cb);
  };
  if (callback != null) {
    result(callback);
  }
  return result;
};

module.exports = {
  status: function(tugboat) {
    return tugboat._docke.ping(function(err, isUp) {
      if ((err != null) || !isUp) {
        console.error();
        console.error('  docker is down'.red);
        console.error();
        return process.exit(1);
      } else {
        return tugboat._docke.ps(function(err, results) {
          var ess, running, stopped;
          if ((err != null) || results.length === 0) {
            console.error();
            console.error('  There are no docker containers on this system'.magenta);
            console.error();
          } else {
            ess = function(num, s, p) {
              if (num === 1) {
                return s;
              } else {
                return p;
              }
            };
            running = results.filter(function(d) {
              return d.inspect.State.Running;
            }).length;
            stopped = results.length - running;
            console.error();
            console.error("  There " + (ess(running, 'is', 'are')) + " " + (running.toString().green) + " running container" + (ess(running, '', 's')) + " and " + (stopped.toString().red) + " stopped container" + (ess(stopped, '', 's')));
            console.error();
          }
          return process.exit(1);
        });
      }
    });
  },
  ps: function(tugboat) {
    return tugboat._docke.ps(function(err, results) {
      var image, name, result, status, _i, _len;
      if (err != null) {
        console.error(err);
        process.exit(1);
      }
      if (results.length === 0) {
        console.error();
        console.error('  There are no docker containers on this system'.magenta);
        console.error();
        return;
      }
      console.log();
      for (_i = 0, _len = results.length; _i < _len; _i++) {
        result = results[_i];
        status = result.inspect.State.Running ? result.inspect.NetworkSettings.IPAddress.toString().blue : 'stopped'.red;
        while (status.length < 26) {
          status += ' ';
        }
        name = result.container.Names[0].slice(1);
        image = result.inspect.Config.Image;
        console.log("  " + status + " " + name + " (" + image + ")");
      }
      return console.log();
    });
  },
  test: function(tugboat) {
    return tugboat.init(function(errors) {
      console.log(errors);
      return console.log(tugboat._groups);
    });
  }
};
